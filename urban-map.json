{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Greater Kuala Lumpur Klang Valley Urban Rail Network â€” 2025",
    "fontSize": 16,
    "subtitle": "Kuala Lumpur, Selangor, Putrajaya (Urban lines only)",
    "subtitleFontStyle": "italic"
  },
  "width": 650,
  "height": 600,
  "projection": {
    "type": "mercator",
    "center": [101.69, 3.13],   // focus on KL city
    "scale": 35000              // zoomed-in scale
  },
  "layer": [
    {
      "mark": {"type": "geoshape", "fill": "#cceeff"}, 
      "data": {"sphere": true}  // ocean background
    },

    {
      "data": {"graticule": {"step": [0.1, 0.1]}},
      "mark": {"type": "geoshape", "stroke": "#cccccc", "strokeWidth": 0.5}
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/zhangkai427007/fit3179/main/states_provinces.json",
        "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
      },
      "mark": {"type": "geoshape", "stroke": "gray", "strokeWidth": 0.5},
      "encoding": {
        "color": {"value": "#e7f0e7"},
        "tooltip": {"field": "properties.name", "title": "State/Region"}
      }
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/zhangkai427007/fit3179/main/route2.json",
        "format": {"property": "features"}
      },
      "transform": [
        {"filter": "datum.properties.network != 'KTM ETS'"},
        {"filter": "datum.properties.network != 'KLIA Express'"},
        {"filter": "datum.properties.network != 'KLIA Transit'"},
        {"flatten": ["geometry.coordinates"]},
        {"calculate": "datum['geometry.coordinates'][0]", "as": "lon"},
        {"calculate": "datum['geometry.coordinates'][1]", "as": "lat"}
      ],
      "mark": {"type": "line", "strokeWidth": 2, "opacity": 0.8},
      "encoding": {
        "longitude": {"field": "lon", "type": "quantitative"},
        "latitude": {"field": "lat", "type": "quantitative"},
        "detail": {"field": "properties.name"},
        "color": {
          "field": "properties.network",
          "type": "nominal",
          "legend": {"title": "Urban Rail Network"},
          "scale": {
            "domain": ["Rapid KL", "MRT", "KL Monorail", "KTM Komuter"],
            "range": ["#e0115f", "#1f78b4", "#69a74c", "#003366"]
          }
        },
        "tooltip": {"field": "properties.name", "title": "Line Name"}
      }
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/zhangkai427007/fit3179/main/export.json",
        "format": {"property": "features"}
      },
      "transform": [
        {"filter": "datum.properties.network != 'KTM ETS'"},
        {"filter": "datum.properties.network != 'KLIA Express'"},
        {"filter": "datum.properties.network != 'KLIA Transit'"}
      ],
      "mark": {"type": "circle", "opacity": 0.85, "size": 25},
      "encoding": {
        "longitude": {"field": "geometry.coordinates[0]", "type": "quantitative"},
        "latitude": {"field": "geometry.coordinates[1]", "type": "quantitative"},
        "tooltip": [
          {"field": "properties.name", "title": "Station Name"},
          {"field": "properties.network", "title": "Network"}
        ],
        "color": {
          "field": "properties.network",
          "type": "nominal",
          "legend": {"title": "Urban Rail Network"},
          "scale": {
            "domain": ["Rapid KL", "MRT", "KL Monorail", "KTM Komuter"],
            "range": ["#e0115f", "#1f78b4", "#69a74c", "#003366"]
          }
        }
      }
    }
  ],

  "config": {
    "view": {"stroke": "transparent"},
    "background": "#ADD8E6"
  }
}
